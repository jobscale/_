#!/usr/bin/env bash
 set -eu

TYPE="ssh_url"

GetAll() {
  for i in {1..4}
  do
    curl -s "https://api.github.com/users/jobscale/repos?type=all&sort=updated&page=$i" | grep $TYPE | awk -F'"' '{print $4}'
  done
}

gitClone() {
  LIST=($(GetAll))
  for repo in ${LIST[@]}
  do
    name=$(echo $repo | awk -F'[:/.]' '{print $4}')
    echo -e "\n# $name"
    [[ ! -d $name ]] && git clone $name
    [[ ! -d $name ]] && continue
    cd $name
    git pull
    git-user
    git branch -a | head
    git diff | cat
    cd - > /dev/null
  done
}

gitDiff() {
  LIST=($(GetAll))
  for repo in ${LIST[@]}
  do
    name=$(echo $repo | awk -F'[:/.]' '{print $4}')
    echo -e "\n# $name"
    [[ ! -d $name ]] && echo "$name not found" && continue
    cd $name
    git remote set-url origin $repo
    git pull
    git diff | cat
    cd - > /dev/null
  done
}

gitDiff() {
  LIST=($(GetAll))
  for repo in ${LIST[@]}
  do
    name=$(echo $repo | awk -F'[:/.]' '{print $4}')
    echo -e "\n# $name"
    [[ ! -d $name ]] && echo "$name not found" && continue
    cd $name
    git remote set-url origin $repo
    git pull
    git diff | cat
    cd - > /dev/null
  done
}

Main() {
  if [[ $# == 0 ]]
  then
    echo "Usage: ${0##*/} [command]"
    echo "[command]:"
    grep ^[a-z] $(which $0) | awk -F'(' '{print $1}'
    return 1
  fi

  FILE=$(date '+/tmp/%s')
  $1 | tee $FILE
  echo "log file = $FILE"
}

Main
